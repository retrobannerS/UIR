\usepackage{tabularx}
\usepackage{booktabs}

\usepackage{polyglossia}
\setmainlanguage[numerals=cyrillic]{russian}
\setotherlanguages{english}
\usepackage{csquotes}

% \usepackage{xunicode} % some extra unicode support
%\usepackage[utf8x]{inputenc}
\usepackage{xltxtra} % \XeLaTeX macro
\usepackage{fontspec}
\defaultfontfeatures{Ligatures=TeX}

%\setromanfont{Charis SIL}
%\setsansfont{Liberation Sans}
%\setmonofont{PT Mono}
%\setmainfont{Liberation Serif} % this allows to use sans-serif as default font


\newfontfamily\cyrillicfont{Times New Roman}
\newfontfamily\cyrillicfontsf{Arial}
\newfontfamily\cyrillicfonttt{Courier New}

\setmainfont{Times New Roman}
\setsansfont{Arial}
\setmonofont{Courier New}

\newfontfamily\englishfont[Script=Latin, Contextuals={WordInitial,WordFinal}]{Times New Roman}
\setotherlanguage[Numerals=Latin]{english}

%нумерация справа и колонтитулы справа вверху
\usepackage{fancyhdr}
\usepackage[a4paper,left=30mm,right=15mm,top=20mm,bottom=20mm,bindingoffset=0cm]{geometry}%

\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}

\usepackage{calc}
\usepackage{ifthen}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{pdfpages}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{indentfirst}
\usepackage[unicode=true]{hyperref}
\usepackage{color}
\usepackage{pgf}
\usepackage{1-preamble/pstheorems}
\usepackage{titling}
\usepackage{totcount}

% Настройка списков (без лишних вертикальных отступов)
\usepackage{paralist}
\setdefaultenum{1.}{1.}{1.}{1.}
\setdefaultitem{--}{}{}{}
%\setlength\itemsep{-1em}
\let\itemize\compactitem
\let\enditemize\endcompactitem
\let\enumerate\compactenum
\let\endenumerate\endcompactenum
\let\description\compactdesc
\let\enddescription\endcompactdesc
\pltopsep=\smallskipamount
\plitemsep=0pt
\plparsep=0pt
% Команда для отмены разрыва страниц перед списками
\makeatletter
\newcommand\mynobreakpar{\par\nobreak\@afterheading}
\makeatother
%%%%%%

\usepackage[singlelinecheck=false,labelsep=endash]{caption}
\captionsetup[table]{justification=justified}
\captionsetup[figure]{justification=justified,name=Рисунок,singlelinecheck=on,font=onehalfspacing}

\usepackage{titlesec}
\titleformat{\chapter}[block]{\centering\normalfont\Large\bfseries}{\thechapter.}{1ex}{}{}
\titlespacing{\chapter}{0pt}{0em}{2em}

\titleformat{\section}[block]{\normalfont\large\bfseries}{\thesection}{1ex}{}{}
\titlespacing{\section}{0pt}{0em}{1ex}

\titleformat{\subsection}[block]{\normalfont\normalsize\bfseries}{\thesubsection}{1ex}{}{}
\titlespacing{\section}{0pt}{0em}{1ex}

% paragraph и subparagraph -- в тексте, без отступов
\titleformat{\paragraph}[runin]{\normalfont\normalsize\bfseries}{\theparagraph}{0pt}{}{}
\titlespacing{\paragraph}{0pt}{0em}{0ex}

\titleformat{\subparagraph}[runin]{\normalfont\normalsize\bfseries}{\thesubparagraph}{0pt}{}{}
\titlespacing{\subparagraph}{0pt}{0em}{0ex}


% Своё название для Cписка литературы
\usepackage{appendix}
\addto\captionsrussian{% Replace "english" with the language you use
  \renewcommand{\contentsname}{Содержание}
  \renewcommand{\appendixname}{Приложение}
}
\newcounter{totalappendices}
\regtotcounter{totalappendices}

\usepackage{mathpartir}

\makeatletter
\let\ps@plain\ps@fancy              % Подчиняем первые страницы каждой главы общим правилам
\makeatother
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\renewcommand{\baselinestretch}{1.5}
\newcommand{\headertext}[1]{\fancyhead[R]{\tiny{#1}}}

%% Список литературы

\usepackage[
  style=gost-numeric,
  sorting=none,
  % language=auto,
  autolang=other
]{biblatex}
\addbibresource{5-bibliography/bibliography.bib}

%% Автоматическое добавление количества источников в реферат
\newtotcounter{citenum}
\AtEveryBibitem{\stepcounter{citenum}}

\usepackage{tikz}
\usepackage{hhline}

\graphicspath{{assets/img}}

%\frenchspacing %% изменение расстояние до и после точек в ряде случаев

\renewcommand{\theenumi}{\arabic{enumi}}
\renewcommand{\theenumii}{\arabic{enumii}}
\renewcommand{\theenumiii}{\arabic{enumiii}}
\renewcommand{\theenumiv}{\arabic{enumiv}}

\renewcommand{\labelenumi}{\theenumi.}
\renewcommand{\labelenumii}{\theenumi.\theenumii.}
\renewcommand{\labelenumiii}{\theenumi.\theenumii.\theenumiii.}
\renewcommand{\labelenumiv}{\theenumi.\theenumii.\theenumiii.\theenumiv.}

%\newenvironment{annotation}{\textbf{Аннотация.} \textit}{}
\theoremstyle{plain}
\newtheorem*{annotation}{Аннотация}

\makeatletter
\newcommand*{\projecttypefulldative}[1]{\gdef\@projecttypefulldative{#1}}
\newcommand*{\theprojecttypefulldative}{\@projecttypefulldative}
\newcommand*{\projecttypeshort}[1]{\gdef\@projecttypeshort{#1}}
\newcommand*{\theprojecttypeshort}{\@projecttypeshort}
\newcommand*{\authorfulldative}[1]{\gdef\@authorfulldative{#1}}
\newcommand*{\theauthorfulldative}{\@authorfulldative}
\newcommand*{\authorgroup}[1]{\gdef\@authorgroup{#1}}
\newcommand*{\theauthorgroup}{\@authorgroup}
\newcommand*{\supervisor}[1]{\gdef\@supervisor{#1}}
\newcommand*{\thesupervisor}{\@supervisor}
\newcommand*{\consultant}[1]{\gdef\@consultant{#1}}
\newcommand*{\theconsultant}{\@consultant}
\newcommand{\projecttasks}[1]{\gdef\@projecttasks{#1}}
\newcommand{\theprojecttasks}{\@projecttasks}
\newcommand{\projecttask}[5]{#1 & #2 & #3 & #4 & #5 \\\hline}
\newcommand*{\taskliterature}[1]{\gdef\@taskliterature{#1}}
\newcommand*{\thetaskliterature}{\@taskliterature}
\newcommand*{\taskdate}[1]{\gdef\@taskdate{#1}}
\newcommand*{\thetaskdate}{\@taskdate}
\newcommand*{\supervisortaskapproval}[1]{\gdef\@supervisortaskapproval{#1}}
\newcommand*{\thesupervisortaskapproval}{\@supervisortaskapproval}
\newcommand*{\authortaskapproval}[1]{\gdef\@authortaskapproval{#1}}
\newcommand*{\theauthortaskapproval}{\@authortaskapproval}
\newcommand*{\authorrspzapproval}[1]{\gdef\@authorrspzapproval{#1}}
\newcommand*{\theauthorrspzapproval}{\@authorrspzapproval}
\newcommand*{\supervisorrspzapproval}[1]{\gdef\@supervisorrspzapproval{#1}}
\newcommand*{\thesupervisorrspzapproval}{\@supervisorrspzapproval}
\newcommand*{\consultantrspzapproval}[1]{\gdef\@consultantrspzapproval{#1}}
\newcommand*{\theconsultantrspzapproval}{\@consultantrspzapproval}
\newcommand*{\supervisorrspzgrade}[1]{\gdef\@supervisorrspzgrade{#1}}
\newcommand*{\thesupervisorrspzgrade}{\@supervisorrspzgrade}
\newcommand*{\consultantrspzgrade}[1]{\gdef\@consultantrspzgrade{#1}}
\newcommand*{\theconsultantrspzgrade}{\@consultantrspzgrade}
\newcommand*{\authorpzapproval}[1]{\gdef\@authorpzapproval{#1}}
\newcommand*{\theauthorpzapproval}{\@authorpzapproval}
\newcommand*{\supervisorpzapproval}[1]{\gdef\@supervisorpzapproval{#1}}
\newcommand*{\thesupervisorpzapproval}{\@supervisorpzapproval}
\newcommand*{\consultantpzapproval}[1]{\gdef\@consultantpzapproval{#1}}
\newcommand*{\theconsultantpzapproval}{\@consultantpzapproval}
\newcommand*{\supervisorpzgrade}[1]{\gdef\@supervisorpzgrade{#1}}
\newcommand*{\thesupervisorpzgrade}{\@supervisorpzgrade}
\newcommand*{\consultantpzgrade}[1]{\gdef\@consultantpzgrade{#1}}
\newcommand*{\theconsultantpzgrade}{\@consultantpzgrade}
\makeatother

%% Настройка подписей
\makeatletter
\pgfkeys{
  /signat/.is family, /signat,
  xsign/.initial=-10pt,
  ysign/.initial=4pt,
  scale/.initial=0.3,
  img/.initial=supervisor,
  xdate/.initial=10pt,
  ydate/.initial=-10pt,
  date/.initial=01.01.2001
}
\makeatother

% Разные подписи для локального и публичного репозиториев
\IfFileExists{3-content/00-project-members-local}{
  % ==== LOCAL ====
  \newcommand{\signaturepath}{assets/signatures/local/}
  \newcommand{\sign}[3][0pt]{%
    \tikz[overlay]{\node[yshift=##1]{\includegraphics[scale=##2]{\signaturepath##3.png}}}%
  }
  \NewDocumentCommand{\signat}{O{}}{%
    \pgfkeys{/signat, ##1}%
    \begin{tikzpicture}[overlay]
      \node[xshift=\pgfkeysvalueof{/signat/xsign}, yshift=\pgfkeysvalueof{/signat/ysign}](c)
      {\includegraphics[scale=\pgfkeysvalueof{/signat/scale}]{\signaturepath\pgfkeysvalueof{/signat/img}.png}};
      \node[xshift=\pgfkeysvalueof{/signat/xdate}, yshift=\pgfkeysvalueof{/signat/ydate}]
      {\small\textit{\pgfkeysvalueof{/signat/date}}};
    \end{tikzpicture}
  }
}{
  % ==== PUBLIC ====
  \newcommand{\signaturepath}{assets/signatures/public/}
  \newcommand{\sign}[3][0pt]{%
    % Аргументы игнорируются, фиксированная заглушка
    \tikz[overlay]{\node[yshift=10pt]{\includegraphics[scale=.15]{\signaturepath##3.png}}}%
  }
  \NewDocumentCommand{\signat}{O{}}{%
    \pgfkeys{/signat, ##1}%
    \begin{tikzpicture}[overlay]
      \node[xshift=-15pt, yshift=7pt](c)
      {\includegraphics[scale=0.1]{\signaturepath\pgfkeysvalueof{/signat/img}.png}};
      \node[xshift=15pt, yshift=-2pt]
      {\small\textit{\pgfkeysvalueof{/signat/date}}};
    \end{tikzpicture}
  }
}

\newcommand{\emptyfield}{\tikz[overlay]{\draw[thin,yshift=-1.28ex](0,0)--(5,0)}}

\newcounter{projecttasknumber}
\newcommand{\projecttasknum}{\setcounter{projectsubtasknumber}{0}\stepcounter{projecttasknumber}\theprojecttasknumber.}

\newcounter{projectsubtasknumber}
\newcommand{\projectsubtasknum}{\stepcounter{projectsubtasknumber}\theprojecttasknumber.\theprojectsubtasknumber.}

\usepackage{listings}

\renewcommand{\lstlistingname}{Листинг}

\lstset{
basicstyle=\linespread{0.94}\ttfamily\small,
tabsize=2,
showstringspaces=false,
columns=flexible,
numbers=none,
numberstyle=\tiny\color{gray},
breaklines=true,
breakatwhitespace=true,
framesep=6pt,
abovecaptionskip=1em,
captionpos=t,
extendedchars=true,
inputencoding=utf8,
literate={Ö}{{\"O}}1
{Ä}{{\"A}}1
{Ü}{{\"U}}1
{ß}{{\ss}}1
{ü}{{\"u}}1
{ä}{{\"a}}1
{ö}{{\"o}}1
{~}{{\textasciitilde}}1
{а}{{\selectfont\char224}}1
{б}{{\selectfont\char225}}1
{в}{{\selectfont\char226}}1
{г}{{\selectfont\char227}}1
{д}{{\selectfont\char228}}1
{е}{{\selectfont\char229}}1
{ё}{{\"e}}1
{ж}{{\selectfont\char230}}1
{з}{{\selectfont\char231}}1
{и}{{\selectfont\char232}}1
{й}{{\selectfont\char233}}1
{к}{{\selectfont\char234}}1
{л}{{\selectfont\char235}}1
{м}{{\selectfont\char236}}1
{н}{{\selectfont\char237}}1
{о}{{\selectfont\char238}}1
{п}{{\selectfont\char239}}1
{р}{{\selectfont\char240}}1
{с}{{\selectfont\char241}}1
{т}{{\selectfont\char242}}1
{у}{{\selectfont\char243}}1
{ф}{{\selectfont\char244}}1
{х}{{\selectfont\char245}}1
{ц}{{\selectfont\char246}}1
{ч}{{\selectfont\char247}}1
{ш}{{\selectfont\char248}}1
{щ}{{\selectfont\char249}}1
{ъ}{{\selectfont\char250}}1
{ы}{{\selectfont\char251}}1
{ь}{{\selectfont\char252}}1
{э}{{\selectfont\char253}}1
{ю}{{\selectfont\char254}}1
{я}{{\selectfont\char255}}1
{А}{{\selectfont\char192}}1
{Б}{{\selectfont\char193}}1
{В}{{\selectfont\char194}}1
{Г}{{\selectfont\char195}}1
{Д}{{\selectfont\char196}}1
{Е}{{\selectfont\char197}}1
{Ё}{{\"E}}1
{Ж}{{\selectfont\char198}}1
{З}{{\selectfont\char199}}1
{И}{{\selectfont\char200}}1
{Й}{{\selectfont\char201}}1
{К}{{\selectfont\char202}}1
{Л}{{\selectfont\char203}}1
{М}{{\selectfont\char204}}1
{Н}{{\selectfont\char205}}1
{О}{{\selectfont\char206}}1
{П}{{\selectfont\char207}}1
{Р}{{\selectfont\char208}}1
{С}{{\selectfont\char209}}1
{Т}{{\selectfont\char210}}1
{У}{{\selectfont\char211}}1
{Ф}{{\selectfont\char212}}1
{Х}{{\selectfont\char213}}1
{Ц}{{\selectfont\char214}}1
{Ч}{{\selectfont\char215}}1
{Ш}{{\selectfont\char216}}1
{Щ}{{\selectfont\char217}}1
{Ъ}{{\selectfont\char218}}1
{Ы}{{\selectfont\char219}}1
{Ь}{{\selectfont\char220}}1
{Э}{{\selectfont\char221}}1
{Ю}{{\selectfont\char222}}1
{Я}{{\selectfont\char223}}1
{…}{\ldots}1
{–}{-}1
{\ }{ }1
}

\headertext{}


% Условие для того, чтобы имена авторов были вымышленные в публичном репозитории автоматически
\IfFileExists{3-content/00-project-members-local}{
  \input{3-content/00-project-members-local}
}{
  \input{3-content/00-project-members-public}
}

\input{3-content/01-task-data}

\newcounter{totalfigures}
\newcounter{totaltables}
\newcounter{totallistings}
